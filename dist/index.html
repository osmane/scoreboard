<!doctype html>
<html lang="en">
  <head>
    <title>billiards scoreboard</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="description" content="billiards scoreboard" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sakura.css/css/sakura.css"
      type="text/css"
    />
  </head>

  <body>
    <h1>Billiards</h1>
    <h2>Play</h2>

    <ul>
      <li>
        <a href="https://tailuge.github.io/billiards/dist/?ruletype=snooker"
          >Snooker</a
        >
      </li>
      <li>
        <a href="https://tailuge.github.io/billiards/dist/?ruletype=nineball"
          >9-Ball</a
        >
      </li>
      <li>
        <a
          href="https://tailuge.github.io/billiards/dist/?ruletype=threecushion"
          >3-Cushion</a
        >
      </li>
      <li>
        <a href="https://tailuge.github.io/billiards/dist/?ruletype=fourteenone"
          >Straight</a
        >
      </li>
    </ul>

    <h2>Recent breaks</h2>

    <div id="breaks"></div>

    <h3>Server stats</h3>

    <div class="chart">
      <canvas id="chart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@^1"></script>

    <script type="module">
      const response = await fetch("https://tailuge-billiards.cyclic.app/usage")
      const data = await response.json()
      const labels = data.map((item) => Date.parse(item.props.created))
      const snooker = data.map((item) => item.props.snooker ?? null)
      const nineball = data.map((item) => item.props.nineball ?? null)
      const fourteenone = data.map((item) => item.props.fourteenone ?? null)
      const threecushion = data.map((item) => item.props.threecushion ?? null)
      const total = data.map(
        (item) => (item.props.play ?? 0) + (item.props.replay ?? 0)
      )
      const multidata = {
        labels: labels,
        datasets: [
          {
            label: "Snooker",
            data: snooker,
          },
          {
            label: "3-Cushion",
            data: threecushion,
          },
          {
            label: "9-ball",
            data: nineball,
          },
          {
            label: "Straight pool",
            data: fourteenone,
          },
          {
            label: "Total games",
            data: total,
            borderWidth: 0.5,
          },
        ],
      }
      const config = {
        type: "line",
        data: multidata,
        options: {
          responsive: true,
          scales: {
            x: {
              type: "time",
              time: {
                unit: "day",
              },
              title: {
                display: true,
                text: "Date",
              },
            },
            y: {
              title: {
                display: true,
                text: "Games",
              },
            },
          },
        },
      }
      const ctx = document.getElementById("chart")
      new Chart(ctx, config)
    </script>

    <script type="module">    
      const count = await await fetch(
        "https://tailuge-billiards.cyclic.app/usage"
      ).json() 
      const breaks = document.getElementById("breaks")

      for (let i = 1; i < count; i++) {
        const node = document.createElement("a")
        node.href = `./replay/${i}`
        node.innerHTML = "ðŸŽ±"
        breaks.appendChild(node)
      }
    </script>
  </body>
</html>
